# ğŸ¦ ShrimpBot - BGR Export WhatsApp Bot

Bot de WhatsApp para consultas de precios de camarÃ³n de BGR Export con integraciÃ³n a Google Sheets y cÃ¡lculos automÃ¡ticos.

## âœ¨ CaracterÃ­sticas

- ğŸ¤– **Interfaz conversacional inteligente** con menÃºs interactivos
- ğŸ“Š **Datos en tiempo real** desde Google Sheets
- ğŸ§® **CÃ¡lculos automÃ¡ticos** usando fÃ³rmulas del Excel (FOB, Glaseo, Flete)
- ğŸ¦ **MÃºltiples productos**: HOSO, HLSO, P&D IQF, P&D BLOQUE, PuD-EUROPA, EZ PEEL, PuD-EEUU, COOKED, PRE-COCIDO, COCIDO SIN TRATAR
- ğŸ“ **Todas las tallas disponibles** segÃºn inventario
- ğŸ’° **CÃ¡lculos de totales** para cantidades especÃ­ficas
- ğŸŒ **Soporte para destinos** internacionales
- ğŸ“± **IntegraciÃ³n completa** con WhatsApp Business API
- ğŸ“„ **GeneraciÃ³n de PDFs** para cotizaciones

## ğŸš€ InstalaciÃ³n Local

### Prerrequisitos
- Python 3.8+
- Cuenta de Twilio con WhatsApp Business API
- Google Sheets con datos de precios (opcional)

### Pasos
1. **Clona el repositorio**
   ```bash
   git clone https://github.com/tu-usuario/BGR-SHRIMP.git
   cd BGR-SHRIMP
   ```

2. **Crea entorno virtual**
   ```bash
   python -m venv venv
   venv\Scripts\activate  # Windows
   source venv/bin/activate  # Linux/Mac
   ```

3. **Instala dependencias**
   ```bash
   pip install -r requirements.txt
   ```

4. **Configura variables de entorno**
   ```bash
   cp .env.example .env
   # Edita .env con tus credenciales reales
   ```

5. **Ejecuta el bot**
   ```bash
   python start.py
   ```

## â˜ï¸ Despliegue en Render

### Variables de Entorno Requeridas

```bash
# Twilio WhatsApp (OBLIGATORIO)
TWILIO_ACCOUNT_SID=tu_account_sid
TWILIO_AUTH_TOKEN=tu_auth_token
TWILIO_WHATSAPP_NUMBER=whatsapp:+tu_numero

# ConfiguraciÃ³n del Servidor
PORT=10000
DEBUG=False
BASE_URL=https://tu-app.onrender.com

# Google Sheets (RECOMENDADO)
GOOGLE_SHEETS_ID=tu_sheet_id
GOOGLE_SHEETS_CREDENTIALS={"type":"service_account",...}

# Opcional
EXCEL_PATH=data/CALCULO_DE_PRECIOS-AGUAJE17.xlsx
OPENAI_API_KEY=tu_openai_key
```

## ğŸ“± Uso del Bot

### Comandos Disponibles

- `hola` - Mostrar menÃº principal
- `1` - Consultar precios
- `2` - InformaciÃ³n de productos
- `3` - Contacto comercial
- `menu` - Volver al menÃº principal
- `confirmar` - Generar PDF de cotizaciÃ³n
- `ayuda` - Mostrar ayuda

### Flujo de Consulta

1. **Saludo inicial** â†’ MenÃº principal
2. **Seleccionar "Precios"** â†’ Lista de tallas
3. **Elegir talla** â†’ Lista de productos disponibles
4. **Seleccionar producto** â†’ CotizaciÃ³n completa
5. **Confirmar** â†’ Generar PDF

### Ejemplos de Consultas Directas

```
Usuario: "precio HLSO 16/20"
Usuario: "21/25 para 15000 lb destino China"
Usuario: "P&D IQF 26/30"
```

## ğŸ§® CÃ¡lculos AutomÃ¡ticos

El bot usa las **fÃ³rmulas exactas** del Excel:

1. **PRECIO BASE** = Precio desde Google Sheets
2. **PRECIO FOB** = `Precio Base - Costo Fijo`
3. **PRECIO GLASEO** = `Precio FOB Ã— Factor Glaseo`
4. **PRECIO FINAL** = `Precio Glaseo + Flete`

### Factores (configurables):
- **Costo Fijo**: $0.29
- **Factor Glaseo**: 0.7
- **Flete**: $0.20

## ğŸ“Š Fuentes de Datos

### Prioridad de Datos:
1. **Google Sheets** (tiempo real) - Recomendado
2. **Excel local** (fallback)
3. **Datos de ejemplo** (desarrollo)

### Estructura de Google Sheets:
- Hoja: "PRECIOS FOB"
- Productos organizados en columnas
- Tallas en filas
- Precios en USD por kg y lb

## ğŸ”§ Arquitectura

```
app/
â”œâ”€â”€ routes.py              # Rutas principales de WhatsApp
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ google_sheets.py   # IntegraciÃ³n con Google Sheets
â”‚   â”œâ”€â”€ excel.py          # Manejo de Excel local
â”‚   â”œâ”€â”€ pricing.py        # LÃ³gica de precios
â”‚   â”œâ”€â”€ interactive.py    # Mensajes interactivos
â”‚   â”œâ”€â”€ session.py        # Manejo de sesiones
â”‚   â”œâ”€â”€ utils.py          # Utilidades y formateo
â”‚   â”œâ”€â”€ pdf_generator.py  # GeneraciÃ³n de PDFs
â”‚   â””â”€â”€ whatsapp_sender.py # EnvÃ­o de mensajes
â”œâ”€â”€ data/                 # Archivos Excel
â””â”€â”€ generated_pdfs/       # PDFs generados
```

## ğŸ”’ Seguridad

- âŒ **NUNCA** subas el archivo `.env` al repositorio
- âœ… Usa `.env.example` como plantilla
- âœ… Configura las variables de entorno en tu servidor de producciÃ³n
- âœ… Las credenciales de Google Sheets estÃ¡n encriptadas

## ğŸš€ CaracterÃ­sticas Avanzadas

- **Sesiones persistentes** por usuario
- **ValidaciÃ³n de entrada** robusta
- **Manejo de errores** completo
- **Logs detallados** para debugging
- **Fallback automÃ¡tico** entre fuentes de datos
- **CÃ¡lculos precisos** con redondeo apropiado

## ğŸ“ˆ Monitoreo

El bot incluye logging detallado para:
- Conexiones a Google Sheets
- CÃ¡lculos de precios
- Interacciones de usuarios
- Errores y excepciones

## ğŸ¤ ContribuciÃ³n

1. Fork el proyecto
2. Crea una rama para tu feature
3. Commit tus cambios
4. Push a la rama
5. Abre un Pull Request

## ğŸ“„ Licencia

Este proyecto es privado y pertenece a BGR Export.

## ğŸ“ Soporte

Para soporte tÃ©cnico o preguntas sobre el bot:
- Email: soporte@bgrexport.com
- WhatsApp: +593 XXX XXXX